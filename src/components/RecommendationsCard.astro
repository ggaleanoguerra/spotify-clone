---

---

<div id="recommendations-container" class="flex flex-wrap mt-6 gap-4"></div>

<script type="module">
  document.addEventListener("DOMContentLoaded", async () => {
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(";").shift();
    }

    const token = getCookie("access_token");

    if (token) {
      try {
        const response = await fetch(
          "https://api.spotify.com/v1/me/top/tracks?limit=8",
          {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          }
        );
        if (!response.ok) {
          throw new Error("Error fetching songs");
        }
        const songs = await response.json();
        console.log(songs);

        const container = document.getElementById("recommendations-container");

        songs.items.forEach((item) => {
          const link = document.createElement("a");
          link.href = item.href;
          link.className =
            "playlist-item transition-all duration-300 flex relative p-2 overflow-hidden items-center gap-5 rounded-md hover:bg-zinc-500 shadow-lg hover:shadow-xl bg-zinc-500/30 w-32";

          const picture = document.createElement("picture");
          picture.className = "aspect-square w-full h-auto flex none";

          const img = document.createElement("img");
          img.src =
            item.album && item.album.images && item.album.images.length > 0
              ? item.album.images[0].url
              : "https://storage.googleapis.com/pr-newsroom-wp/1/2023/05/Spotify_Primary_Logo_RGB_Green.png";
          img.alt = item.name;
          img.className = "object-cover w-full h-full rounded-md";

          picture.appendChild(img);
          link.appendChild(picture);

        //   const name = document.createElement("span");
        //   name.textContent = item.name;
        //   link.appendChild(name);

          container.appendChild(link);
        });
      } catch (error) {
        console.error("Error:", error);
        window.location.href = "/api/login";
      }
    }
  });
</script>
